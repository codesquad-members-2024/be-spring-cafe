<!DOCTYPE html>
<html lang="kr">
<head>
    {{> repeatedHtml/head_data}}
    <![endif]-->
    <link href="/css/user/form.css" rel="stylesheet">
</head>
<body>
<div class="background">
    <nav class="navbar navbar-fixed-top header">
        <div class="col-md-12">
            {{> repeatedHtml/navbar_header}}
            <ul class="nav navbar-nav navbar-right">
                {{> repeatedHtml/navbar_button}}
            </ul>
        </div>
    </nav>

    <div class="container" id="main">
        <header class="post-header">
            <p class="title">회원가입</p>
        </header>
        <form name="question" class="info-container" method="post" action="/user/create">
            <div class="form-group" >
                <label for="userId">아이디</label>
                <input class="form-control" id="userId" name="userId" placeholder="아이디를 입력하세요">
                <button id="checkDuplicateButton" style="margin-left: 20px; cursor: pointer;">중복확인</button>
            </div>
            <div class="form-group">
                <label for="nickname">닉네임</label>
                <input class="form-control" id="nickname" name="nickname" placeholder="닉네임을 입력하세요">
            </div>
            <div class="form-group">
                <label for="email">이메일</label>
                <input type="email" class="form-control" id="email" name="email" placeholder="이메일을 입력하세요">
            </div>
            <div class="form-group">
                <label for="password">비밀번호</label>
                <input type="password" class="form-control" id="password" name="password" placeholder="비밀번호를 입력하세요">
            </div>
            <button type="submit" class="btn btn-success clearfix pull-right">완료</button>
        </form>
    </div>
</div>
</body>
</html>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    document.getElementById("checkDuplicateButton").addEventListener("click", function(event) {
        // /checkUserDuplicate url로 Post 요청을 보낸 뒤, response를 받아 아이디 중복 여부를 확인한다.
        // 아이디의 중복 여부는 판단 가능하지만, 아이디가 중복되도 회원가입이 가능하다.
        // TODO: 아이디 중복 검사를 통화해야지만 회원가입이 가능하도록
        event.preventDefault(); // 폼 제출 기본 동작 방지
        var userId = $("#userId").val(); // 입력된 아이디 가져오기

        // AJAX 요청
        $.ajax({
            url: "/checkUserDuplicate", // 중복 확인을 처리하는 서버의 URL
            method: "POST",
            data: {userId: userId},
            success: function(response) {
                var res = JSON.parse(response);
                if (res.duplicate) {
                    alert("이미 사용중인 아이디 입니다.");
                } else {
                    alert("사용 가능한 아이디 입니다.");
                }
            },
            error: function() {
                alert("서버 오류: 중복 확인에 실패했습니다.");
            }
        });
    });

</script>
